<app-bar (onLoad)="load()" (onShowGraph)="showGraph()" [title]="title" [isVisibleGraph]="visibleGraph" id="bar">
</app-bar>

<div class="container-fluid" id="list" *ngIf="postsModel != undefined">
    <app-line-chart *ngIf="visibleGraph"></app-line-chart>

    <div class="accordion" id="accordionExample" *ngIf="!visibleGraph">
        <div *ngFor="let posts of postsModel.postsSorted; index as i" class="">

            <div class="accordion-item">
                <h2 class="accordion-header" [attr.id]="'heading' + i">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        [attr.data-bs-target]="'#collapse' + i" aria-expanded="false"
                        [attr.aria-controls]="'collapse' + i" [class.collapsed]="i>0">
                        <div class="container-fluid">
                            <div class="row row-cols-auto">
                                <div class="col-sm-3 my-1">{{postsModel.dates[i].dateFrom}} -
                                    {{postsModel.dates[i].dateUntil}}
                                </div>
                                <div class="col-sm-1 text-end my-1">Postů: <br><span
                                        class="fw-bold">{{postsModel.totalCount[i].totalPosts}}</span></div>
                                <div class="col-sm-1 text-end my-1">Autorů: <br><span
                                        class="fw-bold">{{postsModel.totalCount[i].totalAuthors}}</span></div>
                                <div class="col-sm-1 text-end my-1">Komentářů: <br><span
                                        class="fw-bold">{{postsModel.totalCount[i].totalComments}}</span></div>
                                <div class="col-sm-2 text-end my-1">Hlasů: <br><span
                                        class="fw-bold">{{postsModel.totalCount[i].totalVotes}}</span></div>
                                <div class="col-sm-2 text-end my-1">Čekající: <br><span
                                        class="fw-bold">{{postsModel.totalCount[i].totalPending.toFixed(3)}}</span>
                                </div>
                                <div class="col-sm-2 text-end my-1">Vyplaceno: <br><span
                                        class="fw-bold">{{postsModel.totalCount[i].totalPayouts.toFixed(3)}}</span>
                                </div>
                            </div>
                        </div>

                    </button>
                </h2>
                <div [attr.id]="'collapse' + i" class="accordion-collapse collapse"
                    [attr.aria-labelledby]="'heading' + i" data-bs-parent="#accordionExample" [class.show]="i === 0">

                    <ul class="nav nav-tabs mt-3">
                        <li class="nav-item">
                            <button class="nav-link" (click)="clickChangeShowData('post')"
                                [class.active]="showData === 'post'">Posty</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" (click)="clickChangeShowData('author')"
                                [class.active]="showData === 'author'">Autoři</button>
                        </li>
                    </ul>

                    <div class="accordion-body">
                        <!-- Seznam postů-->
                        <div *ngIf="showData === 'post'">
                            <!--data pro desktop-->
                            <div class="desktop">
                                <div class="row h6 fw-bold" *ngIf="posts.length>0">
                                    <div class="col-sm-2 text-start py-2" (click)="clickCreate()"
                                        [class.activeSort]="selectClickedColl==='created'">Vytvořeno</div>
                                    <div class="col-sm-1 text-start py-2" (click)="clickAuthor()"
                                        [class.activeSort]="selectClickedColl==='author'">Autor</div>
                                    <div class="col-sm-3 text-start py-2" (click)="clickTitle()"
                                        [class.activeSort]="selectClickedColl==='title'">Nadpis</div>
                                    <div class="col-sm-2 text-end py-2" (click)="clickPending()"
                                        [class.activeSort]="selectClickedColl==='pending'">Čekající</div>
                                    <div class="col-sm-2 text-end py-2" (click)="clickPayout()"
                                        [class.activeSort]="selectClickedColl==='payout'">Vyplaceno</div>
                                    <div class="col-sm-1 text-end py-2" (click)="clickChildren()"
                                        [class.activeSort]="selectClickedColl==='children'">Komentáře</div>
                                    <div class="col-sm-1 text-end py-2" (click)="clickActiveVotes()"
                                        [class.activeSort]="selectClickedColl==='votes'">Hlasy</div>
                                </div>

                                <div *ngFor="let post of posts" class="row item" (click)="clickItem(post)">
                                    <div class="col-sm-2 text-start">{{this.dateFormat.getLocaleDate(post.created)}}
                                    </div>
                                    <div class="col-sm-1 text-start">{{post.author}}</div>
                                    <div class="col-sm-3 text-start">{{post.title}}</div>
                                    <div class="col-sm-2 text-end">{{post.pending_payout_value}}</div>
                                    <div class="col-sm-2 text-end">{{post.total_payout_value}}</div>
                                    <div class="col-sm-1 text-end">{{post.children}}</div>
                                    <div class="col-sm-1 text-end"><span *ngIf="postsModel.negativeVotes(post)>0"
                                            class="text-danger">{{postsModel.negativeVotes(post)}} |
                                        </span>{{post.active_votes.length}}</div>
                                </div>


                                <div class="row h6 fw-bold mt-2" *ngIf="posts.length>0">
                                    <div class="col-sm-2 text-start">Celkem</div>
                                    <div class="col-sm-1 text-start">Autorů: {{postsModel.totalCount[i].totalAuthors}}
                                    </div>
                                    <div class="col-sm-3 text-start">Postů: {{postsModel.totalCount[i].totalPosts}}
                                    </div>
                                    <div class="col-sm-2 text-end">{{postsModel.totalCount[i].totalPending.toFixed(3)}}
                                        HBD
                                    </div>
                                    <div class="col-sm-2 text-end">{{postsModel.totalCount[i].totalPayouts.toFixed(3)}}
                                        HBD
                                    </div>
                                    <div class="col-sm-1 text-end">{{postsModel.totalCount[i].totalComments}}</div>
                                    <div class="col-sm-1 text-end"><span
                                            *ngIf="postsModel.totalCount[i].totalNegativeVotes>0"
                                            class="text-danger">{{postsModel.totalCount[i].totalNegativeVotes}} |
                                        </span>{{postsModel.totalCount[i].totalVotes}}</div>
                                </div>
                            </div>
                            <!--data pro mobil-->
                            <div class="mobile">
                                <div class="row">
                                    <form class="d-flex"><select [(ngModel)]="selectSortType"
                                            (change)="onChangeTypeSort()" name="typeSort" class="form-select mx-1">
                                            <option *ngFor="let sort of sortTypes" [ngValue]="sort">{{sort.type}}
                                            </option>

                                        </select>
                                        <select [(ngModel)]="selectSortArrow" (change)="onChangeTypeSort()"
                                            class="form-select mx-1" name="arrowSort">
                                            <option *ngFor="let arrow of sortArrows" [ngValue]="arrow">{{arrow.type}}
                                            </option>
                                        </select>
                                    </form>
                                </div>

                                <div *ngFor="let post of posts" class="row item my-1 mobile-item"
                                    (click)="clickItem(post)">
                                    <div class="col-sm text-start fw-bold mx-1">{{post.title}}</div>
                                    <div class="col-sm">
                                        <div class="float-start">{{this.dateFormat.getLocaleDate(post.created)}}</div>
                                        <div class="float-end">@{{post.author}}</div>
                                    </div>

                                    <div class="col-sm">
                                        <div class="float-start">Čekající: {{post.pending_payout_value}}</div>
                                        <div class="float-end">Vyplaceno: {{post.total_payout_value}}</div>
                                    </div>

                                    <div class="col-sm">
                                        <div class="float-start">Komentáře: {{post.children}}</div>
                                        <div class="float-end">Hlasy:
                                            <span *ngIf="postsModel.negativeVotes(post)>0" class="text-danger">
                                                {{postsModel.negativeVotes(post)}} |
                                            </span>{{post.active_votes.length}}
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Seznam autorů-->
                        <div *ngIf="showData === 'author'">
                            <!--data pro desktop-->
                            <div class="desktop">


                                <div class="row h6 fw-bold" *ngIf="postsModel.postsAuthor[i].length>0">
                                    <div class="col-2 text-center py-2" (click)="clickAuthor()"
                                        [class.activeSort]="selectClickedColl==='author'">Autor</div>
                                    <div class="col-2 text-center py-2" (click)="clickPost()"
                                        [class.activeSort]="selectClickedColl==='post'">Posty</div>
                                    <div class="col-2 text-end py-2" (click)="clickPending()"
                                        [class.activeSort]="selectClickedColl==='pending'">Čekající</div>
                                    <div class="col-2 text-end py-2" (click)="clickPayout()"
                                        [class.activeSort]="selectClickedColl==='payout'">Vyplaceno</div>
                                    <div class="col-2 text-end py-2" (click)="clickChildren()"
                                        [class.activeSort]="selectClickedColl==='children'">Komentáře</div>
                                    <div class="col-2 text-end py-2" (click)="clickActiveVotes()"
                                        [class.activeSort]="selectClickedColl==='votes'">Hlasy</div>
                                </div>

                                <div *ngFor="let author of postsModel.postsAuthor[i]" class="row item">
                                    <div class="col-2">@{{author.author}}</div>
                                    <div class="col-2 text-center">{{author.posts}}</div>
                                    <div class="col-2 text-end">{{author.pendingPayoutValue.toFixed(3)}} HBD</div>
                                    <div class="col-2 text-end">{{author.totalPayoutValue.toFixed(3)}} HBD</div>
                                    <div class="col-2 text-end">{{author.comments}}</div>
                                    <div class="col-2 text-end"><span *ngIf="author.negativeVotes>0"
                                            class="text-danger">{{author.negativeVotes}} | </span>{{author.votes}}</div>
                                </div>

                                <div class="row h6 fw-bold mt-2" *ngIf="postsModel.postsAuthor[i].length>0">
                                    <div class="col-2 text-center">Autorů: {{postsModel.totalCount[i].totalAuthors}}
                                    </div>
                                    <div class="col-2 text-center">Postů: {{postsModel.totalCount[i].totalPosts}}</div>
                                    <div class="col-2 text-end">{{postsModel.totalCount[i].totalPending.toFixed(3)}} HBD
                                    </div>
                                    <div class="col-2 text-end">{{postsModel.totalCount[i].totalPayouts.toFixed(3)}} HBD
                                    </div>
                                    <div class="col-2 text-end">{{postsModel.totalCount[i].totalComments}}</div>
                                    <div class="col-2 text-end"><span
                                            *ngIf="postsModel.totalCount[i].totalNegativeVotes>0"
                                            class="text-danger">{{postsModel.totalCount[i].totalNegativeVotes}} |
                                        </span>{{postsModel.totalCount[i].totalVotes}}</div>
                                </div>
                            </div>
                            <!--data pro mobil-->
                            <div class="mobile">
                                <div class="row">
                                    <form class="d-flex"><select [(ngModel)]="selectSortType"
                                            (change)="onChangeTypeSort()" name="typeSort" class="form-select mx-1">
                                            <option *ngFor="let sort of sortTypes" [ngValue]="sort">{{sort.type}}
                                            </option>

                                        </select>
                                        <select [(ngModel)]="selectSortArrow" (change)="onChangeTypeSort()"
                                            class="form-select mx-1" name="arrowSort">
                                            <option *ngFor="let arrow of sortArrows" [ngValue]="arrow">{{arrow.type}}
                                            </option>
                                        </select>
                                    </form>
                                </div>
                                
                                <div *ngFor="let author of postsModel.postsAuthor[i]" class="row item my-1 mobile-item">
                                    <div class="col-sm fw-bold">
                                        <div class="float-start text-start">@{{author.author}}</div>
                                        <div class="float-end text-end">Posty: {{author.posts}}</div>
                                    </div>
                                    <div class="col-sm">
                                        <div class="float-start text-start">Čekající:<br />
                                            {{author.pendingPayoutValue.toFixed(3)}} HBD</div>

                                        <div class="float-end text-end">Vyplaceno:<br />
                                            {{author.totalPayoutValue.toFixed(3)}} HBD
                                        </div>
                                    </div>

                                    <div class="col-sm">
                                        <div class="float-start text-start">Komentáře: {{author.comments}} </div>
                                        <div class="float-end text-end">Hlasy: <span *ngIf="author.negativeVotes>0"
                                                class="text-danger">{{author.negativeVotes}}
                                                | </span>{{author.votes}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

<app-footer id="footer"></app-footer>

<app-modalloadbar *ngIf="showLoadBar"></app-modalloadbar>
<div *ngIf="selectedPost">
    <app-modal [isClosed]="isModalClosed" [title]="selectedPost.title" (crossClicked)="isModalClosed = true">
        <div>
            <div [innerHTML]="selectedBody"></div>
        </div>

    </app-modal>
</div>